<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Set Theory Talks</title>
    <meta
      name="description"
      content="Global set theory seminar and conference announcements"
    />

    <style>
    /*!
    normalize.css v^3.0 | MIT License | git.io/normalize
    Copyright (c) Nicolas Gallagher and Jonathan Neal
    */
    /*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */img,legend{border:0}legend,td,th{padding:0}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,optgroup,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre,textarea{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}table{border-collapse:collapse;border-spacing:0}.hidden,[hidden]{display:none!important}
    /*! END normalize*/

      .gmail_quote {
        display: none;
      }

      * + * {
        margin-top: 1em;
      }

      body {
        margin: 1em;
      }

      #conferences a {
        display: block;
      }

      .post {
        margin: 1em auto;
        max-width: 35em;
        border: 0.5vmin solid lightgray;
        border-radius: 2%;
        padding: 1em;
      }

      .post__date {
        grid-column: 1;
        color: gray;
      }

      .post__date::before {
        content: 'Posted ';
      }

      .post__body {
        white-space: pre-wrap;
        font-family: monospace;
        max-height: 50vh;
        overflow-y: auto;
      }

      .post__title {
      }

      .post__seminar {
        color: red;
      }

      .post__url {
        font-size: 0.8em;
        background-color: lightgray;
        width: max-content;
      }

      .post__url__link::before {
        content: '\1F517\ ';
      }

      .post__tags {
        font-size: 0.8em;
        color: gray;
      }

      .wrapper {
        max-width: 960px;
        margin: 0 auto;
      }

      .wrapper--main {
        padding-top: 0;
        display: grid;
        grid-template-columns: minmax(100%, 1fr);
        grid-gap: 2em;
        grid-auto-flow: row;
      }
      @media (min-width: 500px) {
        .wrapper--main{
          grid-template-columns: minmax(250px, 2fr) minmax(150px, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <header class="wrapper">
      <h1>Set Theory Talks</h1>
      <p>Global set theory seminar and conference announcements</p>
    </header>
    <div class="wrapper wrapper--main">
      <main id="posts"></main>
      <aside id="conferences">
        <h2>Upcoming conferences</h2>
      </aside>
    </div>

    <noscript
      >I'm sorry, Dave, I'm afraid I can't do that. <br />
      You must have disabled JavaScript in your browser because nothing could
      ever fail in my programming. <br />
      -- Hal
    </noscript>

    <script src="https://cdn.jsdelivr.net/gh/mholt/PapaParse/papaparse.min.js"></script>
    <script>
      const json2post = item => {
        const post = document.createElement('div');
        post.setAttribute('data-venue', item[1]);
        if (item[4]) post.setAttribute('data-tags', item[4]);
        const id = `${item[0]}${item[2]}`.hashCode();
        post.id = id;
        post.classList.add('post');
        document.getElementById('posts').append(post);

        const posttitle = document.createElement('h2');
        posttitle.classList.add('post__title');
        posttitle.innerHTML = item[2];
        post.appendChild(posttitle);

        const seminar = document.createElement('div');
        seminar.classList.add('post__seminar');
        seminar.innerHTML = item[1];
        post.appendChild(seminar);

        const postdate = document.createElement('div');
        postdate.classList.add('post__date');
        postdate.innerHTML = item[0];
        post.appendChild(postdate);

        const postbody = document.createElement('div');
        postbody.classList.add('post__body');
        postbody.innerHTML = item[3];
        post.appendChild(postbody);

        if (item[5] !== '') {
          const url = document.createElement('div');
          url.classList.add('post__url');
          url.innerHTML = `<a class="post__url__link" href="${
            item[5]
          }">Link to more info</a>`;
          post.appendChild(url);
        }

        if (item[4] !== '') {
          const tags = document.createElement('div');
          tags.classList.add('post__tags');
          tags.innerHTML = 'Tagged: ' + item[4];
          post.appendChild(tags);
        }
      };

      const json2conf = item => {
        if (item[6]) {
          eventdate = new Date(item[6]);
          today = new Date();
          if (eventdate >= today) {
            const a = document.createElement('a');
            a.innerHTML = item[2];
            const id = `${item[0]}${item[2]}`.hashCode();
            a.href = '#' + id;
            document.getElementById('conferences').append(a);
          }
        }
      };

      String.prototype.hashCode = function() {
        var hash = 0,
          i,
          chr;
        if (this.length === 0) return hash;
        for (i = 0; i < this.length; i++) {
          chr = this.charCodeAt(i);
          hash = (hash << 5) - hash + chr;
          hash |= 0; // Convert to 32bit integer
        }
        return hash;
      };

      const SOURCE = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRGjzhmyqaGaXr0VrrgqPN98SN9lsbnqemQ2QDS-ILSce30ZPQb8AnmxiEX0piNaq88e3I6OTu1BOhC/pub?output=csv';

      fetch(SOURCE)
        .then(function(response) {
          return response.text();
        })
        .then(function(csv) {
          let json = Papa.parse(csv, { delimiter: ',' }).data;
          // console.log(Object.keys(json));
          // console.log(json, csv);
          json.shift();
          // console.log(json);
          for (let key of Object.keys(json)) {
            json2post(json[key]);
            json2conf(json[key]);
          }
        });
        // fetch('https://spreadsheets.google.com/feeds/list/1v53i7TZ7mDfBfWv5ZtBeGaSj-0De54dTxHPq27sz-Tk/od6/public/full?alt=json')
        // .then(function(response) {
        //   return response.json();
        // })
        // .then( (j) => console.log(j));

      // source for 2017 items
      // const OLDSOURCE = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT3Bc8ejCq-PMUtRwBgxLHDZUOS8nTcm6S_bdo_wojdh1LcsQaU92Ey4KEbX5c_GwltOmD2Dypix4w1/pub?output=csv';
        // OLDSOURCE
    </script>
  </body>
</html>
